<!DOCTYPE html>
<html>
  <head>
    <title>Verifiable Barcodes v0.7</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <!--
      === NOTA BENE ===
      For the three scripts below, if your spec resides on dev.w3 you can check them
      out in the same tree and use relative links so that they'll work offline,
     -->
    <script src="//www.w3.org/Tools/respec/respec-w3c" class="remove"></script>
    <script class="remove" src="https://w3c.github.io/vc-data-model/common.js"></script>

    <script type="text/javascript" class="remove">
      var respecConfig = {
        subtitle: "Securing legacy barcodes using Verifiable Credentials",
        // specification status (e.g. WD, LCWD, NOTE, etc.). If in doubt use ED.
        group: "credentials",
        specStatus: "CG-DRAFT",

        // the specification's short name, as in http://www.w3.org/TR/short-name/
        shortName: "verifiable-barcodes",

        // if you wish the publication date to be other than today, set this
        //publishDate:  "",

        // if there is a previously published draft, uncomment this and set its YYYY-MM-DD date
        // and its maturity status
        // previousPublishDate:  "1977-03-15",
        // previousMaturity:  "WD",

        // if there a publicly available Editor's Draft, this is the link
        edDraftURI: "https://digitalbazaar.github.io/verifiable-barcodes/",
        //latestVersion: "",

        // if this is a LCWD, uncomment and set the end of its review period
        //implementationReportURI: "",
        //crEnd: "2024-01-17",

        // if you want to have extra CSS, append them to this list
        // it is recommended that the respec.css stylesheet be kept
        //extraCSS:             ["spec.css", "prettify.css"],

        // editors, add as many as you like
        // only "name" is required
        editors: [{
          name: "Manu Sporny",
          url: "https://www.linkedin.com/in/manusporny/",
          company: "Digital Bazaar",
          companyURL: "https://digitalbazaar.com/",
          w3cid: 41758
        }],

        // authors, add as many as you like.
        // This is optional, uncomment if you have authors as well as editors.
        // only "name" is required. Same format as editors.

        authors: [{
          name: "Manu Sporny", url: "https://www.linkedin.com/in/manusporny/",
          company: "Digital Bazaar", companyURL: "https://digitalbazaar.com/",
          w3cid: 41758
        }],

        // extend the bibliography entries
        //localBiblio: ccg.localBiblio,

        // name of the WG
        //wg:           "W3C Credentials Community Group",

        // URI of the public WG page
        //wgURI:        "https://www.w3.org/community/credentials/",

        // name (with the @w3c.org) of the public mailing to which comments are due
        //wgPublicList: "public-credentials",

        github: "https://github.com/digitalbazaar/verifiable-barcodes/",

        otherLinks: [],

        // URI of the patent status for this WG, for Rec-track documents
        // !!!! IMPORTANT !!!!
        // This is important for Rec-track documents, do not copy a patent URI from a random
        // document unless you know what you're doing. If in doubt ask your friendly neighbourhood
        // Team Contact.
        // wgPatentURI:  "",
        maxTocLevel: 3,
        /*preProcess: [ webpayments.preProcess ],
        alternateFormats: [ {uri: "diff-20111214.html", label: "diff to previous version"} ],
        */
        localBiblio: {
          "CBOR-LD": {
            title: "Compact Binary Object Representation for Linked Data v0.7",
            href: "https://digitalbazaar.github.io/cbor-ld-spec/"
          }
        },
        lint: {"no-unused-dfns": false},
        postProcess: [restrictRefs],
        otherLinks: [{
          key: "Related Specifications",
          data: [{
            value: "The Verifiable Credentials Data Model v2.0",
            href: "https://www.w3.org/TR/vc-data-model-2.0/"
          }, {
            value: "Verifiable Credential Data Integrity v1.0",
            href: "https://www.w3.org/TR/vc-data-integrity/"
          }, {
            value: "The Elliptic Curve Digital Signature Algorithm Cryptosuites v1.0",
            href: "https://www.w3.org/TR/vc-di-ecdsa/"
          }, {
            value: "Compact Binary Object Representation for Linked Data v0.7",
            href: "https://digitalbazaar.github.io/cbor-ld-spec/"
          }]
        }]
      };
    </script>
    <style>
code {
  color: rgb(199, 73, 0);
  font-weight: bold;
}
pre.nohighlight {
  overflow-x: auto;
  white-space: pre-wrap;
}
pre .highlight {
  font-weight: bold;
  color: green;
}
pre .comment {
  font-weight: bold;
  color: Gray;
}
.color-text {
  font-weight: bold;
  text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black;
}
ol.algorithm {
  counter-reset: numsection;
  list-style-type: none;
}
ol.algorithm li {
  margin: 0.5em 0;
}
ol.algorithm li:before {
  font-weight: bold;
  counter-increment: numsection;
  content: counters(numsection, ".") ") ";
}
    </style>
  </head>
  <body>
    <section id="abstract">
      <p>
This specification describes a mechanism to protect legacy optical barcodes,
such as those found on driver's licenses (PDF417) and travel documents (MRZ),
using Verifiable Credentials [[VC-DATA-MODEL-2.0]]. The Verifiable Credential
representations are compact enough such that they fit in under 140 bytes and
can thus be integrated with traditional two-dimensional barcodes that are
printed on physical cards using legacy printing processes.
      </p>
    </section>

    <section id="sotd">

      <p>
This specification is experimental.
      </p>

    </section>

    <section>
      <h2>Introduction</h2>
      <p>
Legacy documentation, such as driver's licenses, passports, and travel
credentials often include machine-readable data that can be used to
quickly read the information from the document. This information is
encoded in formats such as PDF417, machine-readable zone (MRZ), and other
optically scannable codes that are formatted in one-dimensional or
two-dimensional "bars"; thus the name "barcode". This information is often not
protected from tampering and the readily available barcode generation and
scanning libraries mean that it is fairly trivial for anyone to generate
these barcodes.
      </p>
      <p>
It is, therefore, useful for an <a>issuer</a> of these barcodes to protect
the information contained within the barcode as well as the entity that
generated the barcode.
      </p>
      <p>
The [[[VC-DATA-MODEL-2.0]]] specification provides a global standard for
expressing credential information, such as those in a driver's license or
travel document. The [[[VC-DATA-INTEGRITY]]] specification provides a global
standard for securing credential information. These two specifications, when
combined, provide a means of protecting credentials from tampering,
expressing authorship of the credential, and providing the current status of
a credential in a privacy-protecting manner. These data formats, however, tend
to be too large to express in an optical barcode.
      </p>
      <p>
The [[[CBOR-LD]]] specification provides a means of compressing secured
<a>verifiable credentials</a> to the point at which it becomes feasible to
express the information as an optical barcode, or embedded within an optical
barcode.
      </p>
      <p>
This specification describes a mechanism to protect legacy optical barcodes,
such as those found on driver's licenses (PDF417) and travel documents (MRZ),
by using a <a>verifiable credential</a> [[VC-DATA-MODEL-2.0]] to express
information about the barcode, which is then secured using Data Integrity
[[VC-DATA-INTEGRITY]], and then compressed using CBOR-LD [[CBOR-LD]]. The
resulting <a>verifiable credential</a> representations are compact enough such
that they fit in under 140 bytes and can thus be integrated with traditional
two-dimensional barcodes that are printed on physical cards using legacy
printing processes. This adds tamper resistance to the barcode while
optionally enhancing the barcode to provide information related to whether or
not the physical document has been revoked or suspended by the <a>issuer</a>.
      </p>

      <section>
        <h3>Examples of Real World Documents</h3>

        <p>
This section provides a few real world documents and elaborates how a
traditional document's optical barcode is augmented to protect the information
within the barcode. We start off with a typical driver's license:
        </p>

        <figure id="dl-front">
          <img style="margin: auto; display: block; width: 50%;"
               src="diagrams/dl-front.jpg"
               alt="Picture of the front of a driver's license issued by the state of Utopia which contains a picture of the individual that is the subject of the driver's license along with their attributes, such as name, address, height, weight, eye color, and driving privileges.">
          <figcaption style="text-align: center;">
The front of a driver's license issued by the state of Utopia.
          </figcaption>
        </figure>

        <p>
The back of the driver's license contains a PDF417 barcode:
        </p>

        <figure id="dl-back">
          <img style="margin: auto; display: block; width: 50%;"
               src="diagrams/dl-back.jpg"
               alt="Picture of the back of a driver's license issued by the state of Utopia, containing usage rules as well as a PDF417 barcode that encodes much of the information displayed on the front of the card.">
          <figcaption style="text-align: center;">
A back of a driver's license issued by the state of Utopia.
          </figcaption>
        </figure>

        <p>
The PDF417 data contains information that is secured using the algorithms
described in this specification. Namely, the PDF417 barcode contains the
following <a>verifiable credential</a>.
        </p>

        <pre class="example nohighlight"
             title="Verifiable Credential embedded in the PDF417 barcode">
{
  "@context": [
    "https://www.w3.org/ns/credentials/v2",
    "https://w3id.org/vdl/v2",
    "https://w3id.org/vdl/utopia/v1"
  ],
  "type": [
    "VerifiableCredential",
    "OpticalBarcodeCredential"
  ],
  <span class="comment">// the value below is defined as a URL in the 'utopia/v1' context above</span>
  "issuer": "UtopiaDMV",
  "credentialStatus": {
    "type": "OpticalBarcodeStatusList",
    "index": 283749
  },
  "credentialSubject": {
    "type": "Pdf417Barcode",
  },
  "proof": {
    "type": "DataIntegrity",
    "cryptosuite": "ecdsa-vb-2023",
    <span class="comment">// the value below is defined as a URL in the 'utopia/v1' context above</span>
    "verificationMethod": "UtopiaDMV#1"
    "proofPurpose": "assertionMethod",
    "proofValue": "z4peo48uwK2EF4Fta8P...HzQMDYJ34r9gL",
  }
}
        </pre>

        <p>
The <a>verifiable credential</a> above is then compressed using [[CBOR-LD]]
to the following output (in CBOR Diagnostic Notation):
        </p>

        <pre class="example nohighlight"
             title="CBOR-LD compressed Verifiable Credential (137 bytes)">
{
  1 => [ 32768, 32769, 32770],           <span class="comment">// @context</span>
  151 => [ 114, 160 ],                   <span class="comment">// type</span>
  178 => 32782,                          <span class="comment">// issuer</span>
  172 => { 150 => 162, 192 => 283749 },  <span class="comment">// credentialStatus</span>
  174 => { 150 => 158 },                 <span class="comment">// credentialSubject</span>
  180 => {                               <span class="comment">// proof</span>
    150 => 102,                          <span class="comment">// type</span>
    198 => 32771,                        <span class="comment">// cryptosuite</span>
    212 => 32783                         <span class="comment">// verificationMethod</span>
    208 => 214,                          <span class="comment">// proofPurpose</span>
    210 => Uint8Array(65) [ ... ],       <span class="comment">// proofValue</span>
  }
}
        </pre>

      </section>

      <section id="terminology">
        <h3>Terminology</h3>

        <div data-include="https://w3c.github.io/vc-data-model/terms.html"></div>

      </section>

      <section id="conformance">
        <p>
A <dfn>conforming document</dfn> is any concrete expression of the data model
that complies with the normative statements in this specification. Specifically,
all relevant normative statements in Sections
<a href="#data-model"></a> and <a href="#algorithms"></a>
of this document MUST be enforced.
        </p>

        <p>
A <dfn class="lint-ignore">conforming processor</dfn> is any algorithm realized
as software and/or hardware that generates or consumes a
<a>conforming document</a>. Conforming processors MUST produce errors when
non-conforming documents are consumed.
        </p>

      	<p>
This document contains examples of JSON and JSON-LD data. Some of these examples
are invalid JSON, as they include features such as inline comments (`//`)
explaining certain portions and ellipses (`...`) indicating the omission of
information that is irrelevant to the example. Such parts need to be
removed if implementers want to treat the examples as valid JSON or JSON-LD.
        </p>
      </section>

    </section>

    <section>
      <h2>Data Model</h2>

      <p>
The following sections outline the data model that is used by this specification
to express [=verifiable credentials=] that secure optically printed information
such as barcodes and machine-readable zones on travel documents.
      </p>

    </section>

    <section>
      <h2>Algorithms</h2>

      <p>
The following section describes algorithms for adding and verifying digital
proofs that protect optical information, such as barcodes and machine-readable
zones, on physical media, such as driver's licenses and travel documents.
      </p>

      <p>
Generally speaking, the algorithms in this section are effectively the same
as the ones in the [[[VC-DI-ECDSA]]] [[VC-DI-ECDSA]] except that the
algorithm name is different because the cryptographic hashing process includes
the machine-readable barcode information when calculating the digital signature
such that the optical barcode is protected.
      </p>

      <section>
        <h3>ecdsa-vb-2023</h3>

        <p>
The `ecdsa-vb-2023` cryptographic suite takes an input document, canonicalizes
the document using the Universal RDF Dataset Canonicalization Algorithm
[[RDF-CANON]], cryptographically hashes both the original optical barcode
data and the canonicalized verifiable credential data, and then signs the
output resulting in the production of a data integrity proof.
The algorithms in this section also include the verification of such a data
integrity proof.
        </p>

        <section>
          <h4>Add Proof (ecdsa-vb-2023)</h4>

          <p>
To generate a proof, the algorithm in
<a href="https://www.w3.org/TR/vc-data-integrity/#add-proof">
Section 4.1: Add Proof</a> in the Data Integrity
[[VC-DATA-INTEGRITY]] specification MUST be executed.
For that algorithm, the cryptographic suite specific
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-transformation-algorithm">
transformation algorithm</a> is defined in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#transformation-ecdsa-rdfc-2019">
Transformation (ecdsa-rdfc-2019)</a> section of the [[[VC-DI-ECDSA]]], the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-hashing-algorithm">
hashing algorithm</a> is defined in Section
<a href="#hashing-ecdsa-vb-2023"></a>, and the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-proof-serialization-algorithm">
proof serialization algorithm</a> is defined in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#proof-serialization-ecdsa-rdfc-2019">
Proof Serialization (ecdsa-rdfc-2019)</a> section of the [[[VC-DI-ECDSA]]].
          </p>
        </section>

        <section>
          <h4>Verify Proof (ecdsa-vb-2023)</h4>

          <p>
To verify a proof, the algorithm in
<a href="https://www.w3.org/TR/vc-data-integrity/#verify-proof">
Section 4.2: Verify Proof</a> in the Data Integrity [[VC-DATA-INTEGRITY]]
specification MUST be executed. For that algorithm, the cryptographic suite
specific
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-transformation-algorithm">
transformation algorithm</a> is defined in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#transformation-ecdsa-rdfc-2019">
Transformation (ecdsa-rdfc-2019)</a> section of the [[[VC-DI-ECDSA]]], the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-hashing-algorithm">
hashing algorithm</a> is defined in
Section <a href="#hashing-ecdsa-vb-2023"></a>, and the
<a href="https://www.w3.org/TR/vc-data-integrity/#dfn-proof-serialization-algorithm">
proof verification algorithm</a> is defined in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#proof-verification-ecdsa-rdfc-2019">
Proof Verification (ecdsa-rdfc-2019)</a> section of the [[[VC-DI-ECDSA]]].
          </p>
        </section>

        <section>
          <h4>Hashing (ecdsa-vb-2023)</h4>

          <p>
The hashing algorithm is what is defined in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#hashing-ecdsa-rdfc-2019">
Hashing (ecdsa-rdfc-2019)</a> section of the [[[VC-DI-ECDSA]]] specification
with the addition of the hashing of the optical data, as described below. It is
presumed that the implementation makes the machine-readable optical data (PDF417
or MRZ data) available to this hashing algorithm.
          </p>

          <p>
The required inputs to this algorithm are a <em>transformed data document</em>
(<var>transformedDocument</var>), a <em>canonical proof configuration</em>
(<var>canonicalProofConfig</var>), and the <em>optical data</em>
(<var>opticalDataBytes</var>). A single <em>hash data</em> value represented as
series of bytes is produced as output.
          </p>

          <p>
The hashing algorithm is what is defined in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#hashing-ecdsa-rdfc-2019">
Hashing (ecdsa-rdfc-2019)</a> section of the [[[VC-DI-ECDSA]]] with step 3
replaced with the following two steps:
          </p>

          <ol class="algorithm">
            <li>
Let <var>opticalDataHash</var> be the result of applying the same hash algorithm
that was applied to <var>hashData</var> to the <var>opticalDataBytes</var>
value.
            </li>
            <li>
Let <var>hashData</var> be the result of joining <var>proofConfigHash</var> (the
first hash), <var>transformedDocumentHash</var> (the second hash), and
<var>opticalDataHash</var> (the third hash).
            </li>
          </ol>

        </section>

        <section>
          <h4>Proof Configuration (ecdsa-vb-2023)</h4>

          <p>
The proof configuration algorithm is what is defined in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#proof-configuration-ecdsa-rdfc-2019">
Proof Configuration (ecdsa-rdfc-2019)</a> section of the [[[VC-DI-ECDSA]]] with
step 4 replaced with the following step:
          </p>

          <ol class="algorithm">
            <li>
If <var>options</var>.<var>type</var> is not set to `DataIntegrityProof` and
<var>proofConfig</var>.<var>cryptosuite</var> is not set to `ecdsa-vb-2023`, an
`INVALID_PROOF_CONFIGURATION` error MUST be raised.
            </li>
          </ol>

        </section>

      </section>

    </section>

    <section class="informative">
      <h2>Security Considerations</h2>

      <p class="advisement">
Before reading this section, readers are urged to familiarize themselves
with general security advice provided in the
<a href="https://www.w3.org/TR/vc-data-integrity/#security-considerations">
Security Considerations section of the Data Integrity specification</a> as
well as the specific security advice provided in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#security-considerations">
Security Considerations section of the ECDSA Cryptosuites specification</a>.
      </p>

      <p>
In the following sections, we review these important points and direct
the reader to additional information.
      </p>

      <p class="todo">
Add security considerations specific to this specification.
      </p>

    </section>

    <section>
      <h2>Privacy Considerations</h2>

      <p class="advisement">
Before reading this section, readers are urged to familiarize themselves
with general security advice provided in the
<a href="https://www.w3.org/TR/vc-data-integrity/#privacy-considerations">
Security Considerations section of the Data Integrity specification</a> as
well as the specific security advice provided in the
<a href="https://www.w3.org/TR/vc-di-ecdsa/#privacy-considerations">
Security Considerations section of the ECDSA Cryptosuites specification</a>.
      </p>

      <p>
The following section describes privacy considerations that developers
implementing this specification should be aware of in order to avoid violating
privacy assumptions.
      </p>

      <p class="todo">
Add security considerations specific to this specification.
      </p>

    </section>

    <section class="informative">
      <h2>Revision History</h2>

      <p>
This section contains the substantive changes that have been made to this
specification over time.
      </p>

      <p class="issue" title="Content will be filled in after standards-track has been started">
The content for this specification will be filled in after the
standards-track process has been started.
      </p>

    </section>

  </body>
</html>
